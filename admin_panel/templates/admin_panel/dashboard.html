{% extends "admin_panel/base_admin.html" %}
{% load static %}

{% block title %}Dashboard | SCODA{% endblock %}

{% block content %}

<div class="container-fluid">

    <div id="status-message" class="alert alert-success text-center d-none">
        Inicio de sesión exitoso.
    </div>

    <h2 class="text-success fw-bold mb-3">Panel de administración</h2>
    <p class="text-muted mb-4">Gestiona información del día en SCODA.</p>

    <!-- FILTRO POR CURSO -->
    <div class="mb-4 d-flex align-items-center">
        <label class="me-2 fw-semibold text-success">Filtrar por curso:</label>
        <select id="filtro-curso" class="form-select w-auto">
            <option value="">Todos</option>
        </select>
    </div>

    <!-- TARJETA % ASISTENCIA DEL DÍA -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="scoda-card shadow-sm border-0 p-3">
                <div class="d-flex align-items-center">
                    <div class="status-dot bg-success"></div>
                    <div class="ms-3">
                        <p class="mb-0 text-muted small">Asistencia total del día</p>
                        <h2 class="fw-bold mb-0" id="asistencia-porcentaje">--%</h2>
                        <small class="text-muted" id="asistencia-detalle">Cargando...</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TARJETAS -->
    <div class="row g-4 mb-4">

        <div class="col-md-3">
            <div class="scoda-card shadow-sm border-0 p-3 d-flex align-items-center">
                <div class="status-dot bg-danger"></div>
                <div class="ms-3">
                    <p class="mb-0 text-muted small">Ausentes</p>
                    <h2 class="fw-bold mb-0" id="ausentes-count">--</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="scoda-card shadow-sm border-0 p-3 d-flex align-items-center">
                <div class="status-dot bg-purple"></div>
                <div class="ms-3">
                    <p class="mb-0 text-muted small">Extensión</p>
                    <h2 class="fw-bold mb-0" id="extension-count">--</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="scoda-card shadow-sm border-0 p-3 d-flex align-items-center">
                <div class="status-dot bg-warning"></div>
                <div class="ms-3">
                    <p class="mb-0 text-muted small">Anticipados</p>
                    <h2 class="fw-bold mb-0" id="anticipados-count">--</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="scoda-card shadow-sm border-0 p-3 d-flex align-items-center">
                <div class="status-dot bg-success"></div>
                <div class="ms-3">
                    <p class="mb-0 text-muted small">Retiros</p>
                    <h2 class="fw-bold mb-0" id="retiros-count">--</h2>
                </div>
            </div>
        </div>

    </div>

    <!-- GRÁFICO -->
    <div class="card shadow-sm border-0 mb-4 p-3">
        <h5 class="text-success fw-bold mb-3">Resumen diario de estados</h5>
        <canvas id="grafico-estados" height="80"></canvas>
    </div>

    <!-- LISTADO RÁPIDO -->
    <div class="row mt-5">

        <div class="col-md-3">
            <div class="card shadow-sm border-0 p-3">
                <h6 class="fw-bold text-danger">Ausentes (últimos 5)</h6>
                <ul id="lista-ausentes" class="list-group list-group-flush small"></ul>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0 p-3">
                <h6 class="fw-bold text-purple">Extensión (últimos 5)</h6>
                <ul id="lista-extension" class="list-group list-group-flush small"></ul>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0 p-3">
                <h6 class="fw-bold text-warning">Anticipados (últimos 5)</h6>
                <ul id="lista-anticipados" class="list-group list-group-flush small"></ul>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0 p-3">
                <h6 class="fw-bold text-success">Retiros (últimos 5)</h6>
                <ul id="lista-retiros" class="list-group list-group-flush small"></ul>
            </div>
        </div>

    </div>

</div>

{% endblock %}

{% block extra_js %}
{% now "U" as timestamp %}
<script src="{% static 'js/dashboard.js' %}?v={{ timestamp }}"></script>
{% endblock %}
