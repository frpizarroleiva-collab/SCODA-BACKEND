{% extends "admin_panel/base_admin.html" %}
{% load static %}

{% block title %}Gestión de Usuarios | SCODA{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/usuarios.css' %}">

<style>
    /* =============== TOAST GLOBAL DERECHA ================= */
    #notificacion {
        position: fixed;
        top: 90px;          /* debajo de la barra */
        right: 25px;        /* ahora a la derecha */
        background: #198754;
        color: white;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        display: none;
        z-index: 5000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        animation: fadeInOut 3.3s ease forwards;
    }

    /* Loader (compatibilidad) */
    #loader.show {
        display: flex !important;
    }
</style>
{% endblock %}

{% block content %}

<div class="container py-4">

    <!-- Título + botón -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="text-success fw-bold mb-0">
            <i class="bi bi-people-fill me-2"></i> Usuarios del sistema
        </h5>

        <button class="btn btn-success" onclick="abrirModal()">
            <i class="bi bi-person-plus me-1"></i> Nuevo Usuario
        </button>
    </div>

    <!-- Tabla -->
    <div class="table-responsive shadow-sm">
        <table class="table table-hover align-middle" id="usuarios-table">
            <thead class="table-success text-center">
                <tr>
                    <th>#</th>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Rol</th>
                    <th>Activo</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody class="text-center"></tbody>
        </table>
    </div>

</div>

<!-- ============================
     MODAL USUARIO
=============================== -->
<div class="modal fade" id="modalUsuario" tabindex="-1" aria-labelledby="modalTitulo" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <form id="usuarioForm" onsubmit="guardarUsuario(event)">

                <div class="modal-header">
                    <h5 class="modal-title fw-semibold" id="modalTitulo">Nuevo Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <input type="hidden" id="usuarioEmailHidden">

                    <div class="mb-3">
                        <label class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="first_name" placeholder="Nombre">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="last_name" placeholder="Apellido">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Rol</label>
                        <select class="form-select" id="rol" required>
                            <option value="admin">ADMIN</option>
                            <option value="profesor">PROFESOR</option>
                            <option value="porteria">PORTERIA</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Activo</label>
                        <select class="form-select" id="activo">
                            <option value="true">Sí</option>
                            <option value="false">No</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="password" placeholder="••••••">
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-success">Guardar</button>
                </div>

            </form>

        </div>
    </div>
</div>

<!-- Loader global -->
<div id="loader" class="loader">
    <div class="spinner-border text-success me-2" role="status"></div>
    <span id="loader-text">Cargando...</span>
</div>

<!-- Notificación SCODA -->
<div id="notificacion"></div>

{% endblock %}

{% block extra_js %}
{% now "U" as timestamp %}
<script src="{% static 'js/usuarios.js' %}?v={{ timestamp }}"></script>
{% endblock %}
